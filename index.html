<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Lab Randevu Sistemi</title>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    .box { background: #fff; padding: 30px; width: 350px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .hidden { display: none; }
    h2 { text-align: center; color: #333; }
    input, button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
    button { background: #fd366e; color: white; border: none; font-weight: bold; cursor: pointer; }
    .links { margin-top: 15px; text-align: center; font-size: 13px; }
    .links a { color: #0066cc; text-decoration: none; cursor: pointer; display: block; margin-top: 5px; }
    .msg { margin-top: 10px; text-align: center; font-size: 14px; }
  </style>
</head>
<body>

<div id="loginPage" class="box">
  <h2>Giriş Yap</h2>
  <input id="loginEmail" type="email" placeholder="E-posta (ID)">
  <input id="loginPass" type="password" placeholder="Şifre">
  <button onclick="girisYap()">Giriş Yap</button>
  
  <div class="links">
    <a onclick="sayfaDegistir('registerPage')">Yeni Üye Ol</a>
    <a onclick="sifreUnuttum()">Şifremi Unuttum?</a>
  </div>
  <div id="loginMsg" class="msg"></div>
</div>

<div id="registerPage" class="box hidden">
  <h2>Kayıt Ol</h2>
  <input id="regName" type="text" placeholder="Ad Soyad">
  <input id="regEmail" type="email" placeholder="E-posta">
  <input id="regPass" type="password" placeholder="Şifre">
  <button onclick="kayitOl()">Üye Ol</button>
  <div class="links"><a onclick="sayfaDegistir('loginPage')">Geri Dön</a></div>
  <div id="regMsg" class="msg"></div>
</div>

<div id="bookingPage" class="box hidden">
  <h2 id="welcomeMsg">Hoş Geldin</h2>
  <p style="text-align: center; font-size: 14px; color: #666;">Laboratuvar Randevusu Al</p>
  <input id="date" type="date">
  <input id="time" type="time">
  <button onclick="randevuAl()">Randevu Al</button>
  <button style="background:#555; margin-top:5px;" onclick="cikisYap()">Çıkış Yap</button>
  <div id="bookMsg" class="msg"></div>
</div>

<script>
  const { Client, Account, Databases, ID } = Appwrite;
  const client = new Client().setEndpoint('https://cloud.appwrite.io/v1').setProject('6981c32f00212fb21625');
  const account = new Account(client);
  const databases = new Databases(client);

  const DATABASE_ID = '6981c42a00202c6cdf0e'; 
  const COLLECTION_ID = 'appointments';
  let currentUser = null;

  // Sayfalar arası geçiş
  function sayfaDegistir(pageId) {
    document.querySelectorAll('.box').forEach(b => b.classList.add('hidden'));
    document.getElementById(pageId).classList.remove('hidden');
  }

  // ÜYE OL
  async function kayitOl() {
    const name = document.getElementById("regName").value;
    const email = document.getElementById("regEmail").value;
    const pass = document.getElementById("regPass").value;
    try {
      await account.create(ID.unique(), email, pass, name);
      alert("Üyelik başarılı! Giriş yapabilirsiniz.");
      sayfaDegistir('loginPage');
    } catch (e) { document.getElementById("regMsg").innerText = "Hata: " + e.message; }
  }

  // GİRİŞ YAP
  async function girisYap() {
    const email = document.getElementById("loginEmail").value;
    const pass = document.getElementById("loginPass").value;
    try {
      await account.createEmailSession(email, pass);
      currentUser = await account.get();
      document.getElementById("welcomeMsg").innerText = "Merhaba, " + currentUser.name;
      sayfaDegistir('bookingPage');
    } catch (e) { document.getElementById("loginMsg").innerText = "Giriş Başarısız: " + e.message; }
  }

  // RANDEVU AL
  async function randevuAl() {
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    try {
      await databases.createDocument(DATABASE_ID, COLLECTION_ID, ID.unique(), {
        name: currentUser.name, // İsmi otomatik kullanıcı profilinden alırız
        date: date,
        time: time
      });
      alert("✅ Randevu alındı!");
    } catch (e) { alert("Hata: " + e.message); }
  }

  function sifreUnuttum() { alert("Şifre sıfırlama özelliği yakında eklenecek."); }
  async function cikisYap() { await account.deleteSession('current'); location.reload(); }
</script>
</body>
</html>
